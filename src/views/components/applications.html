<!-- Applications Section -->
<section id="applications" class="d-none">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>My Applications</h2>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#applicationDetailsModal">
            <i class="bi bi-plus-circle me-2"></i>Add Application
        </button>
    </div>

    <!-- Application Statistics Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card stats-card bg-primary text-white">
                <div class="card-body">
                    <h6>Total Applications</h6>
                    <h2 id="totalApplications">0</h2>
                    <small class="text-white-50">Last 30 days</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stats-card bg-success text-white">
                <div class="card-body">
                    <h6>Responses Received</h6>
                    <h2 id="totalResponses">0</h2>
                    <small class="text-white-50">Response rate: <span id="responseRate">0%</span></small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stats-card bg-info text-white">
                <div class="card-body">
                    <h6>Interviews Scheduled</h6>
                    <h2 id="totalInterviews">0</h2>
                    <small class="text-white-50">Interview rate: <span id="interviewRate">0%</span></small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stats-card bg-warning text-white">
                <div class="card-body">
                    <h6>Pending Review</h6>
                    <h2 id="pendingReview">0</h2>
                    <small class="text-white-50">Awaiting response</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Applications Table Card -->
    <div class="card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Application History</h5>
                <div class="d-flex gap-2">
                    <div class="input-group">
                        <input type="text" class="form-control" id="applicationSearch" placeholder="Search applications...">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            Filter Status
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" data-filter="all">All Applications</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="pending">Pending</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="interviewing">Interviewing</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="offered">Offered</a></li>
                            <li><a class="dropdown-item" href="#" data-filter="rejected">Rejected</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Position</th>
                            <th>Applied Date</th>
                            <th>Status</th>
                            <th>Source</th>
                            <th>Next Step</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="applicationsTableBody">
                        <!-- Table content will be dynamically populated -->
                    </tbody>
                </table>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-3">
                <div class="showing-entries">
                    Showing <span id="showingStart">1</span> to <span id="showingEnd">10</span> of <span id="totalEntries">0</span> entries
                </div>
                <nav aria-label="Applications pagination">
                    <ul class="pagination mb-0" id="applicationsPagination">
                        <!-- Pagination will be dynamically populated -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</section>

<!-- Add this at the bottom of the file -->
<script type="module">
    import { 
        loadApplications, 
        setupEventListeners, 
        startAutoRefresh, 
        stopAutoRefresh 
    } from '/js/applications.js';

    // Initialize when section becomes visible
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.target.classList.contains('d-none')) {
                // Section was hidden
                stopAutoRefresh();
            } else {
                // Section became visible
                loadApplications();
                setupEventListeners();
                startAutoRefresh(30000); // Refresh every 30 seconds
            }
        });
    });

    // Start observing the applications section
    observer.observe(document.getElementById('applications'), 
        { attributes: true, attributeFilter: ['class'] });
</script>